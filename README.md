# Coding - Final Project
This repository contains all of the code used to perform the data generation required to create a statistical sandbox for testing temperature volatility aggregation. All coding was done in R.

## Project layout
- All scripts can be found in the 'scripts' directory.
- All data generated should be exported to the 'data' directory. 
- All output figures should be exported to the 'output' directory. 

### Scripts
The "run_all.r" script runs each script in the inteded order. The intended order of running scripts is as follows:

 1. region_generation.r
 2. weather_station_generation.r
 3. temperature_data_generation.r 

#### Packages
The script titled "packages_and_seeds.r" must be sourced before going through any individual script as it contains all of the required packages (ggplot2 and tidyverse), custom fucntions (a Euclidian distance metric function and a random temperature generation function), and the random seed used throughout the project. 

#### Region Generation
The "region_generation.r" script generates a rectangular region whose size is based on the contiguous region formed by Iowa, Illinois, Nebraska, and Minnesota (this size can be modified). The region is then (randomly) divided into four rectangular states (which we call A, B, C, and D) and plotted. Each state is also assigned a randomly generated share $s_i$ where $i\in \{ \text{A, B, C, D} \}$ and $\sum_i s_i = 1$. These shares are intended to be used in an intermediate aggregation step to test the effect of custom weighting schemes in aggregation from a state-level to a regional-level. The script outputs the figure titled "region_map.pdf" and the data file titled "state_data.csv". 

#### Weather Station Generation
The script titled "weather_station_generation.r" randomly generates weather stations throughout the region. Weather stations are represented by an $(x,y)$ coordinate. Weather stations are sorted into their respective states and plotted on the region map. The script outputs the figure titled "weather_station_map.pdf" as well as the data files:
- ws_loc_A.csv
- ws_loc_B.csv
- ws_loc_C.csv
- ws_loc_D.csv

which store the coordinates of each weather station in the titular state. 

#### Temperature Generation
The script titled "temperature_data_generation.r" generates temperature data for each weather station generated in the weather station generation script (described above). Temperature data is generated by adding noise to a slightly modified cosine function with frequency $\frac{2\pi}{365}$, amplitude $-30$ and intercept $50$. Independence between weather station data is broken by randomly generating four clusters in the data set (which is achieved by randomly assigning four weather stations as centroids) and letting temperature data for non-centroid points be distributed $\mathcal{N}\left(x^*(t), c d(x, x^*)\right)$ where $x^*$ is the nearest centroid to the weather station $x$, $c$ is specified by the user (defaulted to 2.5 in the winter and 2.0 in the summer), $d(\cdot, \cdot)$ is the Euclidian distance metric between two points projected onto the unit sphere, and $x^*(t)$ is the temperature at time $t$ of the centroid weather station $x^*$. 

This script generates the following output:
- "no_noise_temperature.pdf"
- "noisy_temp_ex.pdf"

and the following data:
- "ws_data_A.csv"
- "ws_data_B.csv"
- "ws_data_C.csv"
- "ws_data_D.csv"

The outputs are examples to help visualize the data generation process, and the data files contain all of the location information and temperature data for each weather station in the titular states.  